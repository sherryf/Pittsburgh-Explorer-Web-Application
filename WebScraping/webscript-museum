# impact packageimport requestsfrom bs4 import BeautifulSoupfrom tidylib import tidy_documentimport jsonimport googlemapsimport csvrecord=[]def collectInfo(links, gmaps):    info = []    for l in links:        temp = {}        temp['category'] = "Museums"        r = requests.get(l)  # use requests library to scrape the master website        tidy, errors = tidy_document(r.text)        soup = BeautifulSoup(tidy, 'html.parser')        temp["name"] = soup.find("div", class_="heading_height").h1.text.strip()        for scr in list(soup.findAll('script')):            if "lazyImgs" in scr.string:                index = scr.string.find("{")                new = scr.string[index:].split("\n    ,   ")                for e in new:                    if "HERO_PHOTO" in e:                        ustr_to_load = unicode(e)                        temp["imgae"] = json.loads(ustr_to_load)['data']                        break                break        address = soup.find_all("span", class_="format_address")[0]        temp['address'] = address.get_text()[9:]        geocode_result = gmaps.geocode(address.get_text()[9:])        temp['geocode'] = geocode_result[0]['geometry']['location']        temp['lat'] = geocode_result[0]['geometry']['location']['lat']        temp['lng'] = geocode_result[0]['geometry']['location']['lng']        try:            temp['rate'] = soup.find_all("span", class_="rate sprite-rating_rr rating_rr")[0].img['content']        except IndexError:            temp['rate'] = "no rate"        try:            if soup.find_all("div", class_="details_wrapper")[0].get_text().strip().startswith(                "Recommended length of visit"):                temp['Recommended length of visit'] = soup.find_all("div", class_="details_wrapper")[0].get_text().strip('\n')[28:].strip().encode("utf8")            else:                temp['Recommended length of visit'] = "no info"        except IndexError:            temp['Recommended length of visit'] = "no info"        try:            #import pdb; pdb.set_trace()            temp['detail'] = soup.find_all("div", class_="listing_details")[0].get_text().strip().encode("utf8")        except IndexError:            try:                temp['detail'] = soup.find_all("div", class_="details_wrapper")[0].get_text().encode("utf8").rstrip()            except IndexError:                temp['detail'] = "no info"        print temp        record.append(temp)def writetocsv():    keys = record[0].keys()    print(keys)    with open('Attractions.csv', 'a') as output_file:        dict_writer = csv.DictWriter(output_file, keys)        dict_writer.writeheader()        dict_writer.writerows(record)def main():    print("start")    gmaps = googlemaps.Client(key='AIzaSyAn-6XiiENx0RGqGcI8_BjKzTUUQAiI7T8')    links = {"https://www.tripadvisor.com/Attraction_Review-g53449-d2707010-Reviews-Bicycle_Heaven-Pittsburgh_Pennsylvania.html",             "https://www.tripadvisor.com/Attraction_Review-g53449-d220086-Reviews-Carnegie_Museum_of_Natural_History-Pittsburgh_Pennsylvania.html",             "https://www.tripadvisor.com/Attraction_Review-g53449-d199154-Reviews-Duquesne_Incline-Pittsburgh_Pennsylvania.html",             "https://www.tripadvisor.com/Attraction_Review-g53449-d294369-Reviews-Cathedral_of_Learning-Pittsburgh_Pennsylvania.html",             "https://www.tripadvisor.com/Attraction_Review-g53449-d220085-Reviews-Senator_John_Heinz_History_Center-Pittsburgh_Pennsylvania.html",             "https://www.tripadvisor.com/Attraction_Review-g53449-d1229295-Reviews-The_Nationality_Rooms-Pittsburgh_Pennsylvania.html",             "https://www.tripadvisor.com/Attraction_Review-g53449-d106589-Reviews-Andy_Warhol_Museum-Pittsburgh_Pennsylvania.html",             "https://www.tripadvisor.com/Attraction_Review-g53449-d272379-Reviews-Carnegie_Science_Center-Pittsburgh_Pennsylvania.html",             "https://www.tripadvisor.com/Attraction_Review-g53449-d2435173-Reviews-Frick_Art_and_Historical_Center-Pittsburgh_Pennsylvania.html",             "https://www.tripadvisor.com/Attraction_Review-g53449-d272118-Reviews-Children_s_Museum_of_Pittsburgh-Pittsburgh_Pennsylvania.html",             "https://www.tripadvisor.com/Attraction_Review-g53449-d220087-Reviews-Carnegie_Museum_of_Art-Pittsburgh_Pennsylvania.html",             "https://www.tripadvisor.com/Attraction_Review-g53449-d6439300-Reviews-Randyland-Pittsburgh_Pennsylvania.html",             "https://www.tripadvisor.com/Attraction_Review-g53449-d272369-Reviews-Fort_Pitt_Museum-Pittsburgh_Pennsylvania.html",             "https://www.tripadvisor.com/Attraction_Review-g53449-d274090-Reviews-Mattress_Factory-Pittsburgh_Pennsylvania.html",             "https://www.tripadvisor.com/Attraction_Review-g53449-d3812443-Reviews-Photo_Antiquities_Museum_of_Photographic_History-Pittsburgh_Pennsylvania.html",             "https://www.tripadvisor.com/Attraction_Review-g53449-d3403571-Reviews-Soldiers_and_Sailors_Memorial_Hall_and_Museum-Pittsburgh_Pennsylvania.html",             "https://www.tripadvisor.com/Attraction_Review-g53449-d1649103-Reviews-The_ScareHouse-Pittsburgh_Pennsylvania.html",             "https://www.tripadvisor.com/Attraction_Review-g53449-d2719043-Reviews-The_Clemente_Museum-Pittsburgh_Pennsylvania.html",             "https://www.tripadvisor.com/Attraction_Review-g53449-d2484939-Reviews-The_Society_for_Contemporary_Craft-Pittsburgh_Pennsylvania.html",             "https://www.tripadvisor.com/Attraction_Review-g53449-d2643393-Reviews-Pittsburgh_Glass_Center_Studios-Pittsburgh_Pennsylvania.html",             "https://www.tripadvisor.com/Attraction_Review-g53449-d11758032-Reviews-Johnny_Angel_s_Ginchy_Stuff_and_Music_Museum-Pittsburgh_Pennsylvania.html",             "https://www.tripadvisor.com/Attraction_Review-g53449-d1592770-Reviews-ToonSeum-Pittsburgh_Pennsylvania.html",             "https://www.tripadvisor.com/Attraction_Review-g53449-d4699024-Reviews-Center_for_PostNatural_History-Pittsburgh_Pennsylvania.html",             "https://www.tripadvisor.com/Attraction_Review-g53449-d2484891-Reviews-Pittsburgh_Center_for_the_Arts-Pittsburgh_Pennsylvania.html",             "https://www.tripadvisor.com/Attraction_Review-g53449-d519340-Reviews-Western_Pennsylvania_Sports_Museum-Pittsburgh_Pennsylvania.html",             "https://www.tripadvisor.com/Attraction_Review-g53449-d2422998-Reviews-James_Gallery-Pittsburgh_Pennsylvania.html",             "https://www.tripadvisor.com/Attraction_Review-g53449-d3367510-Reviews-Pittsburgh_History_Landmarks_Foundation-Pittsburgh_Pennsylvania.html",             "https://www.tripadvisor.com/Attraction_Review-g53449-d106587-Reviews-Carnegie_Institute-Pittsburgh_Pennsylvania.html",             "https://www.tripadvisor.com/Attraction_Review-g53449-d9718758-Reviews-Hart_s-Pittsburgh_Pennsylvania.html",             "https://www.tripadvisor.com/Attraction_Review-g53449-d8834020-Reviews-Four_Winds_Gallery-Pittsburgh_Pennsylvania.html"             }    collectInfo(links,gmaps)    writetocsv()if __name__ == "__main__":    main()